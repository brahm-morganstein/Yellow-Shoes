const MainSearch=class extends HTMLElement{constructor(){super(),this.querySelectorAll(".main-search__close").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault(),document.body.classList.remove("show-search")}))})),this.querySelector(".main-search__input").addEventListener("keyup",(e=>{"Escape"===e.key&&this.querySelector(".main-search__close").dispatchEvent(new Event("click"))})),"true"===this.dataset.quickSearch&&this.initQuickSearch()}initQuickSearch(){const e=this.querySelector(".main-search__input"),t="true"===this.dataset.quickSearchMeta;let s=-1,a=null;const r=()=>{const r=this.querySelector(".main-search__results"),n=e.value;if(n.length&&n!==this.oldSearchValue){this.oldSearchValue=n,null!==a&&(a.abort(),a=null),clearTimeout(s);const i=e.closest("form"),c=new URL(i.action);new URLSearchParams(new FormData(i)).forEach(((e,t)=>{c.searchParams.set(t,e)})),this.classList.remove("main-search--has-results","main-search--results-on-multiple-lines","main-search--no-results"),this.classList.add("main-search--loading"),this.querySelector(".main-search__results-spinner")||(r.innerHTML='<div class="main-search__results-spinner"><div class="loading-spinner"></div></div>'),s=setTimeout((()=>{let e;a=new AbortController,theme.Shopify.features.predictiveSearch?(e=new URL(theme.routes.base+theme.routes.predictiveSearch),e.searchParams.set("q",n),e.searchParams.set("section_id","predictive-search"),e.searchParams.set("resources[limit]",8),e.searchParams.set("resources[options][fields]",t?"title,product_type,variants.title,vendor,tag,variants.sku":"title,product_type,variants.title,vendor")):(e=new URL(c),e.searchParams.set("section_id","main-search")),fetch(e,{method:"get",signal:a.signal}).then((e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.text()})).then((e=>{const t=document.createElement("template");t.innerHTML=e;let s=null;s=theme.Shopify.features.predictiveSearch?t.content.querySelector(".product-grid"):t.content.querySelector(".section-search-template .product-grid"),a=null,this.classList.remove("main-search--has-results","main-search--results-on-multiple-lines","main-search--no-results"),r.innerHTML="";const n=document.createElement("div");n.className="main-search__results__products collection-listing",n.innerHTML="<div></div>";const i=document.createElement("div");i.className="main-search__results__pages",n.firstElementChild.className=s.className,s.querySelectorAll(".product-block:not(.collection-block):not(.page-block)").forEach(((e,t)=>{t<=8&&(e.classList.add("main-search-result"),e.querySelectorAll(".btn.quickbuy-toggle").forEach((e=>e.remove())),e.querySelectorAll(".quickbuy-toggle").forEach((e=>e.classList.remove("quickbuy-toggle"))),n.firstElementChild.appendChild(e))})),s.querySelectorAll(".product-block.page-block").forEach((e=>{const t=document.createElement("a");t.className="main-search-result main-search-result--page",t.href=e.querySelector("a").href,t.innerHTML='<div class="main-search-result__text"></div>',t.firstElementChild.innerText=e.querySelector(".page-block__title").innerText,i.appendChild(t)})),this.classList.remove("main-search--loading");const l=!!n.querySelector(".main-search-result"),o=!!i.querySelector(".main-search-result");if(l||o){if(this.classList.add("main-search--has-results"),this.classList.toggle("main-search--results-on-multiple-lines",n.querySelectorAll(".product-block").length>4),l&&r.appendChild(n),o){const e=document.createElement("h6");e.className="main-search-result__heading",e.innerHTML=theme.strings.generalSearchPages,i.insertAdjacentElement("afterbegin",e),r.appendChild(i)}const e=document.createElement("a");e.className="main-search__results-all-link btn btn--secondary",e.href=c,e.innerHTML=theme.strings.generalSearchViewAll,r.appendChild(e),setTimeout((function(){console.log("fix images in search"),$(".product-block__image").each((function(e,t){let s=$(t).find(".img-ar--contain").first().find("img");1==s.length&&s.each((function(e,t){let s=$(t).data("manual-src");s&&$(t).attr("src",s)}))}))}),2e3)}else{this.classList.add("main-search--no-results");const e=document.createElement("div");e.className="main-search__empty-message",e.innerHTML=theme.strings.generalSearchNoResultsWithoutTerms,r.appendChild(e)}}))}),500)}else n.length||(this.oldSearchValue=n,null!==a&&(a.abort(),a=null),clearTimeout(s),this.classList.remove("main-search--has-results","main-search--results-on-multiple-lines","main-search--loading"),r.innerHTML="")};e.addEventListener("keyup",r.bind(this)),e.addEventListener("change",r.bind(this))}};window.customElements.define("main-search",MainSearch);