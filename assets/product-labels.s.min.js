class ProductLabelManager{constructor(){this.language=Shopify.locale,this.body=$("body"),this.oldHref=window.location.href,this.init()}init(){this.setupInitialLabels(),this.setupUrlChangeListener(),this.setupCustomEventListeners()}setupInitialLabels(){setTimeout((()=>{this.setProductBlockLabels(),this.isProductPage()&&this.setProductPageLabels()}),1e3)}setupUrlChangeListener(){setInterval((()=>{window.location.href!==this.oldHref&&(this.oldHref=window.location.href,setTimeout((()=>{this.setProductBlockLabels(),this.isProductPage()&&this.setProductPageLabels()}),500))}),100)}setupCustomEventListeners(){document.addEventListener("onurlchanged",(()=>{setTimeout((()=>this.setProductBlockLabels()),1e3)}))}isProductPage(){return window.location.href.includes("/products/")}normalizeTag(e){return e.toLowerCase().trim()}generateLabelHTML(e,t){const s="en"===this.language?e.message:e.message_fr;return`\n            <span class="${`product-label product-label--sale product-label-${t}`}">\n                <span style="background-color:${e.bg_color};color:${e.fg_color};">${s}</span>\n            </span>\n        `}mergeLabelContainers(e){if(e.length<=1)return e.first();const t=e.first();for(let s=1;s<e.length;s++)t.append(e.eq(s).html()),e.eq(s).remove();return t}getLabelsForTags(e,t=""){let s=t||"";if(!e||!app_settings?.product_labels)return s;const a=new Set;return Object.keys(app_settings.product_labels).forEach((t=>{const o=app_settings.product_labels[t],r=o.tags.split(",");for(let t of r){const r=this.normalizeTag(t);e.includes(r)&&!a.has(r)&&(s.includes("product-label-"+r)||(s+=this.generateLabelHTML(o,r),a.add(r)))}})),s}setProductBlockLabels(){this.body.find("product-block").each(((e,t)=>{const s=$(t),a=s.attr("data-tags");if(s.closest("#product-crosssell-carousel").length)return;const o=s.find(".product-label-container");if(0===o.length)return;const r=this.mergeLabelContainers(o),n=r.html(),l=this.getLabelsForTags(a,n);l&&l!==n&&r.html(l)}))}setProductPageLabels(){const e=this.body.find("product-form").data("tags");if(!e)return;const t=this.body.find(".main-image").find("variant-content");let s=t.find(".product-label-container");0===s.length&&(s=$('<div class="product-label-container"></div>'),t.append(s));const a=this.mergeLabelContainers(s),o=a.html(),r=this.getLabelsForTags(e,o);r&&r!==o&&a.html(r)}}$(document).ready((()=>{window.productLabelManager=new ProductLabelManager,window.setProductBlockLabels=()=>productLabelManager.setProductBlockLabels(),window.setProductPageLabels=()=>productLabelManager.setProductPageLabels()}));