<style>
  .store-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 2rem;
    padding: 1rem;
  }

  .store-card {
    border: 1px solid #ddd;
    border-radius: 10px;
    overflow: hidden;
    background-color: white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
  }

  .store-card:hover {
    transform: translateY(-5px);
  }

  .store-image {
    width: 100%;
    height: auto;
    display: block;
  }

  .store-content {
    padding: 1rem;
    font-family: sans-serif;
  }

  .location {
    text-transform: uppercase;
    color: #a79b8e;
    font-size: 0.85rem;
    margin-bottom: 0.25rem;
  }

  .neighborhood a {
    font-weight: bold;
    color: #a14426;
    text-decoration: none;
  }

  .address,
  .phone,
  .hours {
    margin: 0.5rem 0;
    font-size: 0.95rem;
    color: #333;
  }

  /* Responsive: 1 column on small screens */
  @media (max-width: 768px) {
    .store-grid {
      grid-template-columns: 1fr;
    }
  }

  .pagination {
    text-align: center;
    padding: 1rem;
    font-family: sans-serif;
  }

  .pagination button {
    padding: 0.5rem 1rem;
    margin: 0 0.5rem;
    border: none;
    background-color: #a14426;
    color: white;
    border-radius: 5px;
    cursor: pointer;
  }

  .pagination button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
  }
</style>

<header style="display:flex;flex-direction:column;justify-content:center;align-items:center;height: 10rem;background-color:#faf2e6;">
  <h1>Our Store Locations</h1>
  <h2>Come say, ‚ÄúHowdy!‚Äù</h2>
</header>

<div style="max-width:80rem;margin: 1rem auto; text-align:right;padding: 1rem;">
  <select id="city-filter" style="padding: 0.5rem; font-size: 1rem;">
    <option value="all">Find stores near me</option>
  </select>
</div>

<div style="max-width:80rem;margin-left:auto;margin-right:auto;">
  <div id="store-grid" class="store-grid"></div>
  <div class="pagination">
    <button id="prev-btn">Previous</button>
    <span id="page-info"></span>
    <button id="next-btn">Next</button>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const locations = app_settings.locations;
    const itemsPerPage = 10;

    let currentPage = getPageFromURL() || 1;
    let currentCity = getCityFromURL() || 'all';

    const storeGrid = document.getElementById('store-grid');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const pageInfo = document.getElementById('page-info');
    const cityFilter = document.getElementById('city-filter');

    function getUniqueCities() {
      const cities = locations.map(loc => loc.city);
      return [...new Set(cities)].sort();
    }

    function populateCityFilter() {
      const cities = getUniqueCities();
      for (const city of cities) {
        const option = document.createElement('option');
        option.value = city;
        option.textContent = city;
        cityFilter.appendChild(option);
      }

      // Set dropdown to currentCity
      cityFilter.value = currentCity;
    }

    function getFilteredLocations() {
      if (currentCity === 'all') return locations;
      return locations.filter(loc => loc.city === currentCity);
    }

    function renderPage(page) {
      const filteredLocations = getFilteredLocations();
      const totalPages = Math.ceil(filteredLocations.length / itemsPerPage);

      // Clamp page value
      currentPage = Math.max(1, Math.min(page, totalPages || 1));

      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const paginatedLocations = filteredLocations.slice(start, end);

      storeGrid.innerHTML = '';

      for (const location of paginatedLocations) {
        const storeCard = `
          <div class="store-card">
            <img src="${location.image_url}" class="store-image" alt="Store image">
            <div class="store-content">
              <p class="location">${location.name}</p>
              <p class="neighborhood">${location.city}</p>
              <p class="address">üìç ${location.line1}</p>
              <p class="phone">üìû ${location.phone}</p>
              <p class="hours">${location.hours}</p>
            </div>
          </div>
        `;
        storeGrid.innerHTML += storeCard;
      }

      pageInfo.textContent = `Page ${currentPage} of ${totalPages || 1}`;
      prevBtn.disabled = currentPage === 1;
      nextBtn.disabled = currentPage >= totalPages;

      updateURLWithParams(currentPage, currentCity);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function updateURLWithParams(page, city) {
      const url = new URL(window.location.href);
      url.searchParams.set('page', page);
      url.searchParams.set('city', city);
      window.history.replaceState({}, '', url);
    }

    function getPageFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      const page = parseInt(urlParams.get('page'));
      return isNaN(page) || page < 1 ? 1 : page;
    }

    function getCityFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('city') || 'all';
    }

    prevBtn.addEventListener('click', () => {
      if (currentPage > 1) {
        currentPage--;
        renderPage(currentPage);
      }
    });

    nextBtn.addEventListener('click', () => {
      const totalPages = Math.ceil(getFilteredLocations().length / itemsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        renderPage(currentPage);
      }
    });

    cityFilter.addEventListener('change', () => {
      currentCity = cityFilter.value;
      currentPage = 1;
      renderPage(currentPage);
    });

    // Init
    populateCityFilter();
    renderPage(currentPage);
  });
</script>


{% schema %}
{
  "name": "Stores Section",
  "settings": [],
  "blocks": [
  ],
  "max_blocks": 12,
  "presets": [
    {
      "name": "Stores Section",
      "category": "Custom"
    }
  ]
}
{% endschema %}
